<!DOCTYPE html>
<!-- 변경 의도: 언어 선택 UI와 메뉴·화장실 안내 다국어 및 모달 적용 -->
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lilliput - 이용 안내</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
        'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      margin: 0;
      background-color: #f9f5ee;
    }

    body.modal-open {
      overflow: hidden;
    }

    .container {
      width: 100vw;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      background-color: #f9f5ee;
      padding: 6rem 1rem 6rem;
    }

    .content {
      max-width: 1000px;
      width: 100%;
    }

    .lang-buttons {
      position: fixed;
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-wrap: nowrap;
      gap: 0.6rem;
      padding: 0.4rem 0.8rem;
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 999px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      max-width: calc(100vw - 1.5rem);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
    }

    .lang-buttons::-webkit-scrollbar {
      height: 4px;
    }

    .lang-buttons::before,
    .lang-buttons::after {
      content: '';
      display: none;
    }

    .lang-btn {
      flex: 0 0 auto;
      margin: 0 0.3rem;
      padding: 0.4rem 0.8rem;
      border: 1px solid #ccc;
      background-color: #fff;
      border-radius: 8px;
      cursor: pointer;
      font-weight: normal;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .lang-btn:hover {
      background-color: #f5f5f5;
    }

    .lang-btn.active {
      border: 2px solid #b35c38;
      background-color: #fff5ef;
      font-weight: bold;
    }

    h1 {
      text-align: center;
      color: #3c2a1e;
      font-size: 1.8rem;
      margin-bottom: 1.5rem;
    }

    .section {
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .section h2 {
      color: #b35c38;
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
    }

    .section ul {
      padding-left: 1rem;
      list-style-position: inside;
    }

    .section li {
      margin-bottom: 0.4rem;
    }

    .footer {
      text-align: center;
      color: #aaa;
      margin-top: 2rem;
      font-size: 0.9rem;
    }

    .floating-actions {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 0.6rem;
      flex-wrap: wrap;
      justify-content: center;
      z-index: 1000;
    }

    .floating-actions .menu-btn,
    .floating-actions .restroom-btn {
      padding: 0.75rem 1.6rem;
      border-radius: 999px;
      font-size: 1rem;
      font-weight: bold;
      text-decoration: none;
      border: none;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .floating-actions .menu-btn {
      background-color: #b35c38;
      color: #fff;
    }

    .floating-actions .menu-btn:hover {
      background-color: #9f4f31;
    }

    .floating-actions .restroom-btn {
      background-color: #fff;
      color: #b35c38;
      border: 2px solid #b35c38;
    }

    .floating-actions .restroom-btn:hover {
      background-color: #fff5ef;
    }

    .floating-actions .menu-btn:active,
    .floating-actions .restroom-btn:active {
      transform: scale(0.98);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      z-index: 2000;
    }

    .modal-backdrop[hidden] {
      display: none;
    }

    .modal-container {
      background: #fff;
      border-radius: 16px;
      max-width: 420px;
      width: 100%;
      padding: 1.5rem;
      position: relative;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .modal-close {
      position: absolute;
      top: 1rem;
      right: 1rem;
      background: none;
      border: none;
      color: #555;
      font-size: 0.95rem;
      cursor: pointer;
    }

    .modal-close:hover {
      color: #b35c38;
    }

    .modal-title {
      font-size: 1.4rem;
      color: #3c2a1e;
      margin: 0;
      text-align: center;
    }

    .modal-steps {
      list-style: decimal;
      padding-left: 1.2rem;
      color: #3c2a1e;
      font-size: 0.98rem;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .modal-image {
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(60, 42, 30, 0.1);
    }

    @media (max-width: 640px) {
      .lang-buttons {
        width: min(280px, 70vw);
        gap: 0.35rem;
        padding: 0.25rem 0.8rem;
        scroll-snap-type: x mandatory;
        scrollbar-width: none;
      }

      .lang-buttons::-webkit-scrollbar {
        display: none;
      }

      .lang-buttons::before,
      .lang-buttons::after {
        display: block;
        position: absolute;
        top: 0;
        bottom: 0;
        width: 0.9rem;
        pointer-events: none;
        z-index: 2;
      }

      .lang-buttons::before {
        left: 0;
        background: linear-gradient(90deg, rgba(249, 245, 238, 0.95), rgba(249, 245, 238, 0));
      }

      .lang-buttons::after {
        right: 0;
        background: linear-gradient(270deg, rgba(249, 245, 238, 0.95), rgba(249, 245, 238, 0));
      }

      .lang-btn {
        padding: 0.32rem 0.7rem;
        margin: 0 0.2rem;
        font-size: 0.9rem;
        scroll-snap-align: center;
      }

      .floating-actions {
        width: min(320px, 90vw);
        gap: 0.4rem;
        flex-direction: column;
      }

      .floating-actions .menu-btn,
      .floating-actions .restroom-btn {
        width: 100%;
        text-align: center;
      }

      .modal-container {
        max-width: 100%;
        padding: 1.25rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="content">
      <!-- 언어 선택 버튼 -->
      <div class="lang-buttons">
        <button class="lang-btn" data-lang="ko">한국어</button>
        <button class="lang-btn" data-lang="en">English</button>
        <button class="lang-btn" data-lang="ja">日本語</button>
        <button class="lang-btn" data-lang="zh">中文</button>
      </div>

      <!-- 제목 -->
      <h1 id="title">이용 안내</h1>

      <!-- 섹션들이 동적으로 렌더링됨 -->
      <div id="sections"></div>

      <div class="footer">Lilliput</div>
    </div>
  </div>

  <div class="floating-actions">
    <a class="menu-btn" id="menu-btn" href="menu.html" aria-label="메뉴판 보기">메뉴판 보기</a>
    <button
      type="button"
      class="restroom-btn"
      id="restroom-btn"
      aria-haspopup="dialog"
      aria-controls="restroom-modal"
      aria-expanded="false"
    >
      화장실 이용법
    </button>
  </div>

  <div
    class="modal-backdrop"
    id="restroom-modal"
    role="dialog"
    aria-modal="true"
    aria-labelledby="restroom-title"
    hidden
  >
    <div class="modal-container" tabindex="-1">
      <button type="button" class="modal-close" id="restroom-modal-close">닫기</button>
      <h2 class="modal-title" id="restroom-title">화장실 이용 방법</h2>
      <ol class="modal-steps" id="restroom-steps"></ol>
      <img
        src="src/image/restroom.PNG"
        alt="화장실 이용 방법 안내 이미지"
        class="modal-image"
        id="restroom-image"
      />
    </div>
  </div>

  <script>
    // 가이드 데이터
    const guideData = {
      ko: {
        title: "이용 안내",
        menuButtonLabel: "메뉴판 보기",
        restroom: {
          buttonLabel: "화장실 이용법",
          title: "화장실 이용 방법",
          steps: [
            "단말기 앞에 서 주세요.",
            "손바닥으로 화면을 깨워 주세요.",
            "비밀번호를 입력해 주세요. (3 6 9 0 *)",
            "문이 열리면 들어가 주세요."
          ],
          closeLabel: "닫기",
          imageAlt: "화장실 이용 방법 4컷 안내 이미지"
        },
        sections: [
          {
            title: "어린이",
            items: [
              "기본 이용 시간: 2시간",
              "평일: 20,000원",
              "주말·공휴일: 22,000원",
              "(12개월 미만 아동: 평일 8,000원 / 주말·공휴일 8,800원)",
              "시간 초과 시: 10분당 평일 2,000원 / 주말·공휴일 2,200원 (12개월 미만 동일)",
            ],
          },
          {
            title: "성인",
            items: ["입장료: 1인 1메뉴 (음료 또는 음식)"],
          },
          {
            title: "영업시간",
            items: [
              "평일: 오전 10:30 ~ 오후 8:30",
              "주말·공휴일: 오전 10:30 ~ 오후 9:00",
            ],
          },
          {
            title: "대관 안내",
            items: [
              "생일 파티 등 행사로 대관을 원하시는 경우 전화로 문의해 주세요.",
              "자세한 안내를 도와드리겠습니다.",
              "02-515-9633",
            ],
          },
        ],
      },
      en: {
        title: "Information",
        menuButtonLabel: "View Menu",
        restroom: {
          buttonLabel: "Restroom Guide",
          title: "How to Use the Restroom",
          steps: [
            "Stand in front of the terminal.",
            "Wake the screen with your palm.",
            "Enter the passcode (3 6 9 0 *).",
            "Enter once the door opens."
          ],
          closeLabel: "Close",
          imageAlt: "Four-panel illustration explaining restroom access steps"
        },
        sections: [
          {
            title: "Children",
            items: [
              "Basic usage time: 2 hours",
              "Weekdays: 20,000 KRW",
              "Weekends & holidays: 22,000 KRW",
              "(Under 12 months: 8,000 KRW weekdays / 8,800 KRW weekends)",
              "Overtime: Every 10 min - 2,000 KRW (weekdays), 2,200 KRW (weekends, same for under 12 months)",
            ],
          },
          {
            title: "Adults",
            items: ["Admission: One Drink or Food per Adult per person"],
          },
          {
            title: "Business Hours",
            items: [
              "Weekdays: 10:30 AM ~ 8:30 PM",
              "Weekends & Holidays: 10:30 AM ~ 9:00 PM",
            ],
          },
          {
            title: "Rental",
            items: [
              "For birthday parties or event space rental, please call us.",
              "We will guide you with the details.",
              "02-515-9633",
            ],
          },
        ],
      },
      ja: {
        title: "ご利用案内",
        menuButtonLabel: "メニューを見る",
        restroom: {
          buttonLabel: "トイレの使い方",
          title: "トイレの利用手順",
          steps: [
            "端末の前に立ってください。",
            "手のひらで画面を起こしてください。",
            "暗証番号（3 6 9 0 *）を入力してください。",
            "扉が開いたらお入りください。"
          ],
          closeLabel: "閉じる",
          imageAlt: "トイレの利用方法を説明する4コマイラスト"
        },
        sections: [
          {
            title: "お子様",
            items: [
              "基本利用時間：2時間",
              "平日：20,000ウォン",
              "週末・祝日：22,000ウォン",
              "（12ヶ月未満のお子様：平日8,000ウォン／週末・祝日8,800ウォン）",
              "時間超過時：10分ごとに平日2,000ウォン／週末・祝日2,200ウォン（12ヶ月未満も同様）",
            ],
          },
          {
            title: "大人",
            items: ["入場料：大人お一人につき、ドリンクまたはフード1品のご注文をお願いします"],
          },
          {
            title: "営業時間",
            items: [
              "平日：午前10:30 ～ 午後8:30",
              "週末・祝日：午前10:30 ～ 午後9:00",
            ],
          },
          {
            title: "貸切案内",
            items: [
              "誕生日パーティーなどのイベント貸切をご希望の場合は、お電話でお問い合わせください。",
              "詳細をご案内いたします。",
              "02-515-9633",
            ],
          },
        ],
      },
      zh: {
        title: "使用指南",
        menuButtonLabel: "查看菜单",
        restroom: {
          buttonLabel: "洗手间使用",
          title: "洗手间使用方法",
          steps: [
            "请站在终端前。",
            "用手掌唤醒屏幕。",
            "输入密码（3 6 9 0 *）。",
            "门打开后即可进入。"
          ],
          closeLabel: "关闭",
          imageAlt: "四格漫画形式的洗手间使用步骤说明图"
        },
        sections: [
          {
            title: "儿童",
            items: [
              "基本使用时间：2小时",
              "平日：20,000韩元",
              "周末及节假日：22,000韩元",
              "（12个月以下儿童：平日8,000韩元 / 周末8,800韩元）",
              "超时：每10分钟 平日2,000韩元 / 周末2,200韩元（12个月以下同样适用）",
            ],
          },
          {
            title: "成人",
            items: ["入场费：每位成人需点一份饮品或食物"],
          },
          {
            title: "营业时间",
            items: [
              "平日：上午10:30 ~ 下午8:30",
              "周末及节假日：上午10:30 ~ 下午9:00",
            ],
          },
          {
            title: "包场信息",
            items: [
              "如需生日派对或其他活动的包场服务，请致电咨询。",
              "我们将为您详细介绍相关信息。",
              "02-515-9633",
            ],
          },
        ],
      },
    };

    const STORAGE_KEY = 'lilliputPreferredLang';
    const LANGUAGE_FALLBACK = 'en';
    const fallbackMenuLabel = guideData[LANGUAGE_FALLBACK]?.menuButtonLabel || 'View Menu';
    const fallbackRestroomData = guideData[LANGUAGE_FALLBACK]?.restroom || {
      buttonLabel: 'Restroom Guide',
      title: 'How to Use the Restroom',
      steps: [],
      closeLabel: 'Close',
      imageAlt: '',
    };

    // 브라우저 언어 감지
    const detectLanguage = () => {
      const browserLang = navigator.language || navigator.userLanguage || '';
      if (browserLang.startsWith('ko')) return 'ko';
      if (browserLang.startsWith('ja')) return 'ja';
      if (browserLang.startsWith('zh')) return 'zh';
      return LANGUAGE_FALLBACK;
    };

    const loadPreferredLanguage = () => {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored && guideData[stored]) {
          return stored;
        }
      } catch (error) {
        console.warn('언어 설정을 불러오지 못했습니다.', error);
      }
      return detectLanguage();
    };

    const savePreferredLanguage = lang => {
      try {
        localStorage.setItem(STORAGE_KEY, lang);
      } catch (error) {
        console.warn('언어 설정을 저장하지 못했습니다.', error);
      }
    };

    // 현재 언어 상태
    let currentLang = loadPreferredLanguage();
    let currentRestroomContent = fallbackRestroomData;
    const langButtonsContainer = document.querySelector('.lang-buttons');
    const langButtons = Array.from(document.querySelectorAll('.lang-btn'));
    const menuButton = document.getElementById('menu-btn');
    const restroomButton = document.getElementById('restroom-btn');
    const restroomModal = document.getElementById('restroom-modal');
    const restroomModalContainer = restroomModal?.querySelector('.modal-container');
    const restroomCloseButton = document.getElementById('restroom-modal-close');
    const restroomTitleElement = document.getElementById('restroom-title');
    const restroomStepsElement = document.getElementById('restroom-steps');
    const restroomImageElement = document.getElementById('restroom-image');
    let isRestroomModalOpen = false;
    let lastFocusedElement = null;

    function renderRestroomGuide(restroomData) {
      const base = fallbackRestroomData;
      const active = Object.assign({}, base, restroomData || {});
      currentRestroomContent = active;

      if (restroomButton) {
        const label = active.buttonLabel || base.buttonLabel || '';
        restroomButton.textContent = label;
        restroomButton.setAttribute('aria-label', label);
        restroomButton.setAttribute('aria-expanded', String(isRestroomModalOpen));
      }

      if (restroomTitleElement) {
        restroomTitleElement.textContent = active.title || base.title || '';
      }

      if (restroomStepsElement) {
        restroomStepsElement.innerHTML = '';
        const steps = Array.isArray(active.steps) && active.steps.length ? active.steps : base.steps || [];
        steps.forEach(step => {
          const li = document.createElement('li');
          li.textContent = step;
          restroomStepsElement.appendChild(li);
        });
      }

      if (restroomCloseButton) {
        const closeLabel = active.closeLabel || base.closeLabel || 'Close';
        restroomCloseButton.textContent = closeLabel;
        restroomCloseButton.setAttribute('aria-label', closeLabel);
      }

      if (restroomImageElement) {
        const altText = active.imageAlt || base.imageAlt || '';
        if (altText) {
          restroomImageElement.setAttribute('alt', altText);
        } else {
          restroomImageElement.removeAttribute('alt');
        }
      }
    }

    function openRestroomModal() {
      if (!restroomModal || isRestroomModalOpen) return;
      isRestroomModalOpen = true;
      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;
      restroomModal.hidden = false;
      document.body.classList.add('modal-open');
      renderRestroomGuide(currentRestroomContent);
      setTimeout(() => {
        if (restroomModalContainer) {
          restroomModalContainer.focus();
        } else if (restroomCloseButton) {
          restroomCloseButton.focus();
        }
      }, 0);
    }

    function closeRestroomModal() {
      if (!restroomModal || !isRestroomModalOpen) return;
      isRestroomModalOpen = false;
      restroomModal.hidden = true;
      document.body.classList.remove('modal-open');
      renderRestroomGuide(currentRestroomContent);
      const focusTarget = lastFocusedElement && typeof lastFocusedElement.focus === 'function'
        ? lastFocusedElement
        : restroomButton;
      if (focusTarget && typeof focusTarget.focus === 'function') {
        focusTarget.focus();
      }
    }

    function handleModalKeydown(event) {
      if (event.key === 'Escape' && isRestroomModalOpen) {
        closeRestroomModal();
      }
    }

    function setupRestroomInteraction() {
      if (restroomButton) {
        restroomButton.addEventListener('click', () => {
          openRestroomModal();
        });
      }

      if (restroomCloseButton) {
        restroomCloseButton.addEventListener('click', () => {
          closeRestroomModal();
        });
      }

      if (restroomModal) {
        restroomModal.addEventListener('click', event => {
          if (event.target === restroomModal) {
            closeRestroomModal();
          }
        });
      }

      document.addEventListener('keydown', handleModalKeydown);
    }

    // 페이지 렌더링
    function render() {
      const data = guideData[currentLang] || guideData[LANGUAGE_FALLBACK];
      if (!data) {
        console.error('지원하지 않는 언어 코드입니다:', currentLang);
        return;
      }
      
      // 제목 업데이트
      document.getElementById('title').textContent = data.title;
      document.documentElement.lang = currentLang;
      const menuLabel = data.menuButtonLabel || fallbackMenuLabel;
      if (menuButton) {
        menuButton.textContent = menuLabel;
        menuButton.setAttribute('aria-label', menuLabel);
      }
      renderRestroomGuide(data.restroom);
      
      // 섹션들 렌더링
      const sectionsContainer = document.getElementById('sections');
      sectionsContainer.innerHTML = '';
      
      data.sections.forEach(section => {
        const sectionDiv = document.createElement('div');
        sectionDiv.className = 'section';
        
        const h2 = document.createElement('h2');
        h2.textContent = section.title;
        sectionDiv.appendChild(h2);
        
        const ul = document.createElement('ul');
        section.items.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item;
          ul.appendChild(li);
        });
        sectionDiv.appendChild(ul);
        
        sectionsContainer.appendChild(sectionDiv);
      });
      
      // 활성 버튼 표시
      langButtons.forEach(btn => {
        if (btn.dataset.lang === currentLang) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });

      centerActiveLanguageButton();
    }

    function centerActiveLanguageButton() {
      if (!langButtonsContainer) return;
      const activeButton = langButtonsContainer.querySelector('.lang-btn.active');
      if (activeButton) {
        activeButton.scrollIntoView({ block: 'nearest', inline: 'center', behavior: 'smooth' });
      }
    }

    // 언어 버튼 클릭 이벤트
    langButtons.forEach(btn => {
      if (!btn.dataset.bound) {
        btn.addEventListener('click', () => {
          currentLang = btn.dataset.lang;
          savePreferredLanguage(currentLang);
          render();
        });
        btn.dataset.bound = 'true';
      }
    });

    // 초기 렌더링
    render();
    setupRestroomInteraction();
  </script>

  <footer style="font-size:0.8rem; color:#999; text-align:center; margin-top:40px; padding:20px 0;">
    © Lilliput Cheongdam · 본 사이트는 쿠키 및 로컬 저장소를 기능 제공 목적으로만 사용합니다.
  </footer>
</body>
</html>
